<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>

    <!-- Document root: Azure serves from /home/site/wwwroot, but Laravel
         needs requests to go to /public. The rules below handle that. -->

    <rewrite>
      <rules>
        <!-- Redirect root to /public -->
        <rule name="RootToPublic" stopProcessing="true">
          <match url="^$" />
          <action type="Redirect" url="/public/" redirectType="Permanent" />
        </rule>

        <!-- Route all requests through Laravel's front controller -->
        <rule name="Laravel Routes" stopProcessing="true">
          <match url="^(.*)$" ignoreCase="false" />
          <conditions>
            <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
          </conditions>
          <action type="Rewrite" url="public/index.php" />
        </rule>

        <!-- Static assets served directly from /public -->
        <rule name="Static Assets" stopProcessing="true">
          <match url="^public/(.*)$" ignoreCase="false" />
          <conditions>
            <add input="{REQUEST_FILENAME}" matchType="IsFile" />
          </conditions>
          <action type="None" />
        </rule>
      </rules>
    </rewrite>

    <staticContent>
      <mimeMap fileExtension=".webp" mimeType="image/webp" />
      <mimeMap fileExtension=".woff"  mimeType="font/woff" />
      <mimeMap fileExtension=".woff2" mimeType="font/woff2" />
    </staticContent>

    <httpErrors errorMode="Detailed" />

    <security>
      <requestFiltering>
        <!-- Allow larger file uploads (e.g. room images) -->
        <requestLimits maxAllowedContentLength="52428800" />
      </requestFiltering>
    </security>

  </system.webServer>
</configuration>
